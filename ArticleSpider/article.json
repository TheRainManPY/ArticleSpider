{"url_object_id": "2d2fe070e21aca17bf9d6ef863e27af3", "create_date": "2017/12/21", "front_image_path": "full/d925c992a1aa410e25f0bb681dae99423f162420.jpg", "title": "PostgreSQL 查询成本模型", "url": "http://blog.jobbole.com/113358/", "tags": "IT技术,PostgreSQL,数据库", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"http://shiroyasha.io/the-postgresql-query-cost-model.html\">igor_sarcevic</a>   译文出处：<a target=\"_blank\" href=\"http://blog.csdn.net/dev_csdn/article/details/78841624\">CSDN/无阻我飞扬</a>   </div><p><em>摘要：PostgreSQL是一个自由的对象-关系数据库服务器(数据库管理系统)，被业界誉为“最先进的开源数据库”，本文作者以代码实例说明了如何计算和评估PostgreSQL查询成本，以下是译文。</em></p>\n<p>数据库查询速度如果太慢会从很多方面损害机构，比如可能会损害一些优秀应用程序的声誉，因为数据库查询速度过慢，造成后台处理速度慢得令人痛苦，并大幅增加基础设施的成本。作为一名经验丰富的Web开发人员，了解数据层的优化策略是绝对必要的。</p>\n<p><img class=\"aligncenter\" title=\"\" src=\"http://jbcdn2.b0.upaiyun.com/2017/12/e5e6809a4b86af8aff9897d8f816be4c.jpeg\" alt=\"这里写图片描述\"></p>\n<p>在本文中，我们将探讨PostgreSQL的成本模型，如何了解<code>explain</code>命令（关于explain命令可参见这篇<a href=\"http://toplchx.iteye.com/blog/2091860\" target=\"_blank\">文章</a>）的输出，最重要的是如何利用这些模型数据来提高应用程序的吞吐量。</p>\n<h1 id=\"使用postgresql-explain-命令\">使用PostgreSQL Explain 命令</h1>\n<p>在应用程序中部署一个新的查询语句之前，最好通过PostgreSQL中的 <code>explain</code>中的命令来运行它，以评估新查询对应用系统性能的影响。</p>\n<p>以一个示例数据库表开始，来说明<code>explain</code>命令的用法。这个表存有一百万条数据记录。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a47ad209a5ab173030983\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndb # CREATE TABLE users (id serial, name varchar);\r\n\r\ndb # INSERT INTO users (name) SELECT 'John'\r\n FROM generate_series(1, 1000000);\r\n\r\ndb # SELECT count(*) FROM users;\r\n      count\r\n\r\n 1000000\r\n(1 row)\r\n\r\ndb # SELECT id, name FROM users LIMIT 10;\r\n id | name\r\n----+------\r\n  1 | John\r\n  2 | John\r\n  3 | John\r\n  4 | John\r\n  5 | John\r\n  6 | John\r\n  7 | John\r\n  8 | John\r\n  9 | John\r\n 10 | John\r\n(10 rows)\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a47ad209a5ab173030983-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a47ad209a5ab173030983-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a47ad209a5ab173030983-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a47ad209a5ab173030983-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a47ad209a5ab173030983-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a47ad209a5ab173030983-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a47ad209a5ab173030983-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a47ad209a5ab173030983-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a47ad209a5ab173030983-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a47ad209a5ab173030983-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a47ad209a5ab173030983-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a47ad209a5ab173030983-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a47ad209a5ab173030983-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a47ad209a5ab173030983-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a47ad209a5ab173030983-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a47ad209a5ab173030983-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a47ad209a5ab173030983-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a47ad209a5ab173030983-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5a47ad209a5ab173030983-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a47ad209a5ab173030983-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5a47ad209a5ab173030983-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a47ad209a5ab173030983-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5a47ad209a5ab173030983-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a47ad209a5ab173030983-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5a47ad209a5ab173030983-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a47ad209a5ab173030983-26\">26</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a47ad209a5ab173030983-1\"><span class=\"crayon-v\">db</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># CREATE TABLE users (id serial, name varchar);</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a47ad209a5ab173030983-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a47ad209a5ab173030983-3\"><span class=\"crayon-v\">db</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># INSERT INTO users (name) SELECT 'John'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a47ad209a5ab173030983-4\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">generate_series</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1000000</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a47ad209a5ab173030983-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a47ad209a5ab173030983-6\"><span class=\"crayon-v\">db</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># SELECT count(*) FROM users;</span></div><div class=\"crayon-line\" id=\"crayon-5a47ad209a5ab173030983-7\"><span class=\"crayon-h\">      </span><span class=\"crayon-i\">count</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a47ad209a5ab173030983-8\"> </div><div class=\"crayon-line\" id=\"crayon-5a47ad209a5ab173030983-9\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1000000</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a47ad209a5ab173030983-10\"><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">row</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a47ad209a5ab173030983-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a47ad209a5ab173030983-12\"><span class=\"crayon-v\">db</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># SELECT id, name FROM users LIMIT 10;</span></div><div class=\"crayon-line\" id=\"crayon-5a47ad209a5ab173030983-13\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a47ad209a5ab173030983-14\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line\" id=\"crayon-5a47ad209a5ab173030983-15\"><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">John</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a47ad209a5ab173030983-16\"><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">John</span></div><div class=\"crayon-line\" id=\"crayon-5a47ad209a5ab173030983-17\"><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">John</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a47ad209a5ab173030983-18\"><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">4</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">John</span></div><div class=\"crayon-line\" id=\"crayon-5a47ad209a5ab173030983-19\"><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">5</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">John</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a47ad209a5ab173030983-20\"><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">6</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">John</span></div><div class=\"crayon-line\" id=\"crayon-5a47ad209a5ab173030983-21\"><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">7</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">John</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a47ad209a5ab173030983-22\"><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">8</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">John</span></div><div class=\"crayon-line\" id=\"crayon-5a47ad209a5ab173030983-23\"><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">9</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">John</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a47ad209a5ab173030983-24\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">John</span></div><div class=\"crayon-line\" id=\"crayon-5a47ad209a5ab173030983-25\"><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">10</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rows</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a47ad209a5ab173030983-26\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0034 seconds] -->\r\n<p>假设需要用一个给定的id来查找一个用户名，但是在部署新的查询代码之前，要评估这个查询操作的成本。运行一个explain语句来做相关查询：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a47ad209a5b4735821124\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndb # EXPLAIN SELECT * FROM users WHERE id = 870123;\r\n\r\n        QUERY PLAN                  \r\n--------------------------------------------------\r\n Gather  (cost=1000.00..11614.43 rows=1 width=9)\r\n   Workers Planned: 2\r\n           -&gt;  Parallel Seq Scan on users  (cost=0.00..10614.33 rows=1 width=9)\r\n     Filter: (id = 870123)\r\n\r\n(4 rows)\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a47ad209a5b4735821124-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a47ad209a5b4735821124-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a47ad209a5b4735821124-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a47ad209a5b4735821124-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a47ad209a5b4735821124-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a47ad209a5b4735821124-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a47ad209a5b4735821124-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a47ad209a5b4735821124-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a47ad209a5b4735821124-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a47ad209a5b4735821124-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a47ad209a5b4735821124-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a47ad209a5b4735821124-1\"><span class=\"crayon-v\">db</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># EXPLAIN SELECT * FROM users WHERE id = 870123;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a47ad209a5b4735821124-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a47ad209a5b4735821124-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">QUERY </span><span class=\"crayon-v\">PLAN</span><span class=\"crayon-h\">                  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a47ad209a5b4735821124-4\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line\" id=\"crayon-5a47ad209a5b4735821124-5\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Gather</span><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cost</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1000.00..11614.43</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rows</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">width</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">9</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a47ad209a5b4735821124-6\"><span class=\"crayon-h\">   </span><span class=\"crayon-e\">Workers </span><span class=\"crayon-v\">Planned</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line\" id=\"crayon-5a47ad209a5b4735821124-7\"><span class=\"crayon-h\">           </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">Parallel </span><span class=\"crayon-e\">Seq </span><span class=\"crayon-e\">Scan </span><span class=\"crayon-e\">on </span><span class=\"crayon-e\">users</span><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cost</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0.00..10614.33</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rows</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">width</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">9</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a47ad209a5b4735821124-8\"><span class=\"crayon-h\">     </span><span class=\"crayon-v\">Filter</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">870123</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a47ad209a5b4735821124-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a47ad209a5b4735821124-10\"><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">4</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rows</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a47ad209a5b4735821124-11\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p>在上面的例子中有很多的输出，但是可以得到它的要点。为了运行这个查询，PostgreSQL计划启动两个并行的工作进程（workers）。每个工作进程将在表上进行顺序扫描，最后，收集器合并来自两个工作进程的结果。</p>\n<p>在本文中，重点介绍上面输出的<code>cost</code>以及PostgreSQL如何计算它。</p>\n<p>为了简化成本探索，运行上面的查询，但限制可并行的工作进程数量为0。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a47ad209a5b8897710155\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndb # SET max_parallel_workers_per_gather = 0;\r\n\r\ndb # EXPLAIN SELECT * FROM users WHERE id = 870123;\r\n\r\n                   QUERY PLAN\r\n--------------------------------------------------\r\n Seq Scan on users  (cost=0.00..17906.00 rows=1 width=9)\r\n   Filter: (id = 870123)\r\n\r\n(2 rows)\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a47ad209a5b8897710155-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a47ad209a5b8897710155-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a47ad209a5b8897710155-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a47ad209a5b8897710155-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a47ad209a5b8897710155-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a47ad209a5b8897710155-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a47ad209a5b8897710155-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a47ad209a5b8897710155-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a47ad209a5b8897710155-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a47ad209a5b8897710155-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a47ad209a5b8897710155-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a47ad209a5b8897710155-1\"><span class=\"crayon-v\">db</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># SET max_parallel_workers_per_gather = 0;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a47ad209a5b8897710155-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a47ad209a5b8897710155-3\"><span class=\"crayon-v\">db</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># EXPLAIN SELECT * FROM users WHERE id = 870123;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a47ad209a5b8897710155-4\"> </div><div class=\"crayon-line\" id=\"crayon-5a47ad209a5b8897710155-5\"><span class=\"crayon-h\">                   </span><span class=\"crayon-e\">QUERY </span><span class=\"crayon-v\">PLAN</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a47ad209a5b8897710155-6\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line\" id=\"crayon-5a47ad209a5b8897710155-7\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Seq </span><span class=\"crayon-e\">Scan </span><span class=\"crayon-e\">on </span><span class=\"crayon-e\">users</span><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cost</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0.00..17906.00</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rows</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">width</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">9</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a47ad209a5b8897710155-8\"><span class=\"crayon-h\">   </span><span class=\"crayon-v\">Filter</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">870123</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a47ad209a5b8897710155-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a47ad209a5b8897710155-10\"><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rows</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a47ad209a5b8897710155-11\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p>这有点简单。在只有单CPU内核的情况下，评估成本是<code>17906</code>。</p>\n<h1 id=\"成本值背后的数学\">成本值背后的数学</h1>\n<p>在PostgreSQL中，成本或惩罚点大多是一个抽象的概念。PostgreSQL可以执行查询的方式很多，而PostgreSQL总是选择最低成本值的执行规划。</p>\n<p>计算成本，PostgreSQL首先查看表的字节数大小。接下来看看用户表的大小。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a47ad209a5bc399007925\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndb # select pg_relation_size('users');\r\n\r\n pg_relation_size\r\n--------------------------\r\n     44285952\r\n(1 row)\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a47ad209a5bc399007925-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a47ad209a5bc399007925-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a47ad209a5bc399007925-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a47ad209a5bc399007925-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a47ad209a5bc399007925-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a47ad209a5bc399007925-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a47ad209a5bc399007925-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a47ad209a5bc399007925-1\"><span class=\"crayon-v\">db</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># select pg_relation_size('users');</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a47ad209a5bc399007925-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a47ad209a5bc399007925-3\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pg_relation_size</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a47ad209a5bc399007925-4\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line\" id=\"crayon-5a47ad209a5bc399007925-5\"><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">44285952</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a47ad209a5bc399007925-6\"><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">row</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a47ad209a5bc399007925-7\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>PostgreSQL会为每个要依次读取的块添加成本点。如果知道每个块都包含了<code>8kb</code>，那么就可以计算从表中读取的顺序块的成本值。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a47ad209a5c0905190114\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nblock_size = 8192 # block size in bytes\r\nrelation_size = 44285952\r\n\r\nblocks = relation_size / block_size # =&gt; 5406\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a47ad209a5c0905190114-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a47ad209a5c0905190114-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a47ad209a5c0905190114-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a47ad209a5c0905190114-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a47ad209a5c0905190114-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a47ad209a5c0905190114-1\"><span class=\"crayon-v\">block_size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8192</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># block size in bytes</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a47ad209a5c0905190114-2\"><span class=\"crayon-v\">relation_size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">44285952</span></div><div class=\"crayon-line\" id=\"crayon-5a47ad209a5c0905190114-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a47ad209a5c0905190114-4\"><span class=\"crayon-v\">blocks</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">relation_size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">block_size</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># =&gt; 5406</span></div><div class=\"crayon-line\" id=\"crayon-5a47ad209a5c0905190114-5\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>现在，已经知道块的数量，找出PostgreSQL为每个块读取分配多少个成本点。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a47ad209a5c3627606682\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndb # SHOW seq_page_cost;\r\n seq_page_cost\r\n ----------\r\n 1\r\n(1 row)\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a47ad209a5c3627606682-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a47ad209a5c3627606682-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a47ad209a5c3627606682-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a47ad209a5c3627606682-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a47ad209a5c3627606682-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a47ad209a5c3627606682-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a47ad209a5c3627606682-1\"><span class=\"crayon-v\">db</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># SHOW seq_page_cost;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a47ad209a5c3627606682-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">seq_page_cost</span></div><div class=\"crayon-line\" id=\"crayon-5a47ad209a5c3627606682-3\"><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a47ad209a5c3627606682-4\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-5a47ad209a5c3627606682-5\"><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">row</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a47ad209a5c3627606682-6\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>换句话说，PostgreSQL为每个块分配一个成本点。这就需要 <code>5406</code>个成本点从表中读取数据。</p>\n<p>从磁盘读取值并不是PostgreSQL需要做的。它必须将这些值发送给CPU并应用一个<code>WHERE</code>子句过滤。对于这个计算来说，如下的两个值非常有趣。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a47ad209a5c7493844638\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndb # SHOW cpu_tuple_cost;\r\n\r\n cpu_tuple_cost\r\n--------------------\r\n  0.01\r\ndb # SHOW cpu_operator_cost;\r\n cpu_operator_cost\r\n ----------------\r\n  0.0025\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a47ad209a5c7493844638-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a47ad209a5c7493844638-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a47ad209a5c7493844638-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a47ad209a5c7493844638-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a47ad209a5c7493844638-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a47ad209a5c7493844638-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a47ad209a5c7493844638-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a47ad209a5c7493844638-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a47ad209a5c7493844638-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a47ad209a5c7493844638-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a47ad209a5c7493844638-1\"><span class=\"crayon-v\">db</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># SHOW cpu_tuple_cost;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a47ad209a5c7493844638-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a47ad209a5c7493844638-3\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cpu_tuple_cost</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a47ad209a5c7493844638-4\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line\" id=\"crayon-5a47ad209a5c7493844638-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0.01</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a47ad209a5c7493844638-6\"><span class=\"crayon-v\">db</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># SHOW cpu_operator_cost;</span></div><div class=\"crayon-line\" id=\"crayon-5a47ad209a5c7493844638-7\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cpu_operator_cost</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a47ad209a5c7493844638-8\"><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line\" id=\"crayon-5a47ad209a5c7493844638-9\"><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0.0025</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a47ad209a5c7493844638-10\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>现在，用所有的值来计算在<code>explain</code> 语句中得到的值。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a47ad209a5ca128274686\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nnumber_of_records = 1000000\r\n\r\nblock_size    = 8192     # block size in bytes\r\nrelation_size = 44285952\r\n\r\nblocks = relation_size / block_size # =&gt; 5406\r\n\r\nseq_page_cost   = 1\r\ncpu_tuple_cost  = 0.01\r\ncpu_filter_cost = 0.0025;\r\n\r\ncost = blocks * seq_page_cost +\r\n   number_of_records * cpu_tuple_cost +\r\n   number_of_records * cpu_filter_cost\r\n\r\ncost # =&gt; 17546\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a47ad209a5ca128274686-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a47ad209a5ca128274686-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a47ad209a5ca128274686-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a47ad209a5ca128274686-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a47ad209a5ca128274686-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a47ad209a5ca128274686-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a47ad209a5ca128274686-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a47ad209a5ca128274686-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a47ad209a5ca128274686-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a47ad209a5ca128274686-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a47ad209a5ca128274686-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a47ad209a5ca128274686-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5a47ad209a5ca128274686-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a47ad209a5ca128274686-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5a47ad209a5ca128274686-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a47ad209a5ca128274686-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5a47ad209a5ca128274686-17\">17</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a47ad209a5ca128274686-1\"><span class=\"crayon-v\">number_of_records</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1000000</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a47ad209a5ca128274686-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a47ad209a5ca128274686-3\"><span class=\"crayon-v\">block_size</span><span class=\"crayon-h\">    </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8192</span><span class=\"crayon-h\">     </span><span class=\"crayon-p\"># block size in bytes</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a47ad209a5ca128274686-4\"><span class=\"crayon-v\">relation_size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">44285952</span></div><div class=\"crayon-line\" id=\"crayon-5a47ad209a5ca128274686-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a47ad209a5ca128274686-6\"><span class=\"crayon-v\">blocks</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">relation_size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">block_size</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># =&gt; 5406</span></div><div class=\"crayon-line\" id=\"crayon-5a47ad209a5ca128274686-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a47ad209a5ca128274686-8\"><span class=\"crayon-v\">seq_page_cost</span><span class=\"crayon-h\">   </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-5a47ad209a5ca128274686-9\"><span class=\"crayon-v\">cpu_tuple_cost</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.01</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a47ad209a5ca128274686-10\"><span class=\"crayon-v\">cpu_filter_cost</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.0025</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5a47ad209a5ca128274686-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a47ad209a5ca128274686-12\"><span class=\"crayon-v\">cost</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">blocks *</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">seq_page_cost</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span></div><div class=\"crayon-line\" id=\"crayon-5a47ad209a5ca128274686-13\"><span class=\"crayon-h\">   </span><span class=\"crayon-e \">number_of_records *</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cpu_tuple_cost</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a47ad209a5ca128274686-14\"><span class=\"crayon-h\">   </span><span class=\"crayon-e \">number_of_records *</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">cpu_filter_cost</span></div><div class=\"crayon-line\" id=\"crayon-5a47ad209a5ca128274686-15\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a47ad209a5ca128274686-16\"><span class=\"crayon-v\">cost</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># =&gt; 17546</span></div><div class=\"crayon-line\" id=\"crayon-5a47ad209a5ca128274686-17\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p></p>\n<h1 id=\"索引和postgresql成本模型\">索引和PostgreSQL成本模型</h1>\n<p>索引在数据库工程师的生活中很可能仍然是最重要的话题。添加索引是否可以降低SELECT语句的成本呢？通过下面的例子来找出答案。</p>\n<p>首先，在users表中添加一个索引：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a47ad209a5cd701274312\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndb # CREATE INDEX idx_users_id ON users (id);\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a47ad209a5cd701274312-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a47ad209a5cd701274312-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a47ad209a5cd701274312-1\"><span class=\"crayon-v\">db</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># CREATE INDEX idx_users_id ON users (id);</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a47ad209a5cd701274312-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>观察一下新索引的查询规划。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a47ad209a5d0808832507\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndb # EXPLAIN SELECT * FROM users WHERE id = 870123;\r\n\r\n           QUERY PLAN\r\n----------  ----------  ----------\r\n     Index Scan using idx_users_id on users  (cost=0.42..8.44 rows=1 width=9)\r\n   Index Cond: (id = 870123)\r\n(2 rows)\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a47ad209a5d0808832507-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a47ad209a5d0808832507-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a47ad209a5d0808832507-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a47ad209a5d0808832507-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a47ad209a5d0808832507-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a47ad209a5d0808832507-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a47ad209a5d0808832507-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a47ad209a5d0808832507-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a47ad209a5d0808832507-1\"><span class=\"crayon-v\">db</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># EXPLAIN SELECT * FROM users WHERE id = 870123;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a47ad209a5d0808832507-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a47ad209a5d0808832507-3\"><span class=\"crayon-h\">           </span><span class=\"crayon-e\">QUERY </span><span class=\"crayon-v\">PLAN</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a47ad209a5d0808832507-4\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line\" id=\"crayon-5a47ad209a5d0808832507-5\"><span class=\"crayon-h\">     </span><span class=\"crayon-e\">Index </span><span class=\"crayon-e\">Scan </span><span class=\"crayon-e\">using </span><span class=\"crayon-e\">idx_users_id </span><span class=\"crayon-e\">on </span><span class=\"crayon-e\">users</span><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cost</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0.42..8.44</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rows</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">width</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">9</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a47ad209a5d0808832507-6\"><span class=\"crayon-h\">   </span><span class=\"crayon-e\">Index </span><span class=\"crayon-v\">Cond</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">870123</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5a47ad209a5d0808832507-7\"><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rows</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a47ad209a5d0808832507-8\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n<p>成本函数显著下降。索引扫描的计算比顺序扫描的计算要复杂一些。它由两个阶段组成。</p>\n<p>PostgreSQL会考虑<code>random_page_cost</code>和<code>cpu_index_tuple_cost</code> 变量，并返回一个基于索引树的高度的值。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a47ad209a5d4595740616\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndb # SHOW random_page_cost;\r\n\r\n random_page_cost\r\n ----------------\r\n  4\r\n\r\ndb # SHOW cpu_index_tuple_cost;\r\n cpu_index_tuple_cost\r\n----------\r\n  0.005\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a47ad209a5d4595740616-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a47ad209a5d4595740616-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a47ad209a5d4595740616-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a47ad209a5d4595740616-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a47ad209a5d4595740616-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a47ad209a5d4595740616-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a47ad209a5d4595740616-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a47ad209a5d4595740616-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a47ad209a5d4595740616-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a47ad209a5d4595740616-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a47ad209a5d4595740616-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a47ad209a5d4595740616-1\"><span class=\"crayon-v\">db</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># SHOW random_page_cost;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a47ad209a5d4595740616-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a47ad209a5d4595740616-3\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">random_page_cost</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a47ad209a5d4595740616-4\"><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line\" id=\"crayon-5a47ad209a5d4595740616-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">4</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a47ad209a5d4595740616-6\"> </div><div class=\"crayon-line\" id=\"crayon-5a47ad209a5d4595740616-7\"><span class=\"crayon-v\">db</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># SHOW cpu_index_tuple_cost;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a47ad209a5d4595740616-8\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cpu_index_tuple_cost</span></div><div class=\"crayon-line\" id=\"crayon-5a47ad209a5d4595740616-9\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a47ad209a5d4595740616-10\"><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0.005</span></div><div class=\"crayon-line\" id=\"crayon-5a47ad209a5d4595740616-11\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>对于实际的计算，请考虑阅读<a href=\"https://github.com/postgres/postgres/blob/ab72716778128fb63d54ac256adf7fe6820a1185/src/backend/optimizer/path/costsize.c#L466\" target=\"_blank\">成本指数</a>计算器的源代码。</p>\n<h1 id=\"工作进程的成本\">工作进程的成本</h1>\n<p>PostgreSQL可以启动并行的工作进程（worker）来执行查询。但是，开启一个新的工作进程，性能会受到影响。</p>\n<p>为了计算使用并行工作进程的成本，PostgreSQL使用 <code>parallel_tuple_cost</code>这个命令，它定义了从一个工作进程传送元组到另一个工作进程的成本，<code>parallel_setup_cost</code>命令意味着启动一个新的工作进程（worker）的成本，以下是查询示例。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5a47ad209a5d7900961732\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndb # SHOW parallel_tuple_cost;\r\n\r\n parallel_tuple_cost\r\n---------------------\r\n  0.1\r\n\r\ndb # SHOW parallel_setup_cost;\r\n\r\n parallel_setup_cost\r\n---------------------\r\n 1000\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5a47ad209a5d7900961732-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a47ad209a5d7900961732-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5a47ad209a5d7900961732-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a47ad209a5d7900961732-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5a47ad209a5d7900961732-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a47ad209a5d7900961732-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5a47ad209a5d7900961732-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a47ad209a5d7900961732-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5a47ad209a5d7900961732-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a47ad209a5d7900961732-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5a47ad209a5d7900961732-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5a47ad209a5d7900961732-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5a47ad209a5d7900961732-1\"><span class=\"crayon-v\">db</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># SHOW parallel_tuple_cost;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a47ad209a5d7900961732-2\"> </div><div class=\"crayon-line\" id=\"crayon-5a47ad209a5d7900961732-3\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">parallel_tuple_cost</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a47ad209a5d7900961732-4\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span></div><div class=\"crayon-line\" id=\"crayon-5a47ad209a5d7900961732-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0.1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a47ad209a5d7900961732-6\"> </div><div class=\"crayon-line\" id=\"crayon-5a47ad209a5d7900961732-7\"><span class=\"crayon-v\">db</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># SHOW parallel_setup_cost;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a47ad209a5d7900961732-8\"> </div><div class=\"crayon-line\" id=\"crayon-5a47ad209a5d7900961732-9\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">parallel_setup_cost</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a47ad209a5d7900961732-10\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span></div><div class=\"crayon-line\" id=\"crayon-5a47ad209a5d7900961732-11\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1000</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5a47ad209a5d7900961732-12\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113358\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113358votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113358\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share